package com.oxleya.malwareconnector.process;

import org.springframework.integration.annotation.ServiceActivator;
import org.springframework.messaging.handler.annotation.Header;
import org.springframework.stereotype.Component;

import java.io.IOException;
import java.nio.file.Files;
import java.nio.file.Path;
import java.nio.file.Paths;

@Component
public class ProcessMalwareTransactionService {

    @ServiceActivator(inputChannel = "successfulMalwareTransactionChannel", outputChannel = "nullChannel")
    private void onSuccess(@Header("file_originalFile") String fileLocation) throws IOException {
        System.out.println("file path: " + fileLocation);
        Path path = Paths.get(fileLocation);
        if (Files.notExists(Paths.get(path.getParent().getParent().toString() + "/success"))) {
            Files.createDirectories(Paths.get(path.getParent().getParent().toString() + "/success"));
        }
        Files.move(path, Paths.get(path.getParent().getParent().toString() + "/success/" + path.getFileName()));
    }
}
